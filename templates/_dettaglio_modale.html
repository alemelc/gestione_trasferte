{# templates/_dettaglio_modale.html #}
<table class="table table-sm table-bordered">

    {# BLOCCO INFORMAZIONI GENERALI E RICHIESTA #}
    <tr>
        <th>Richiedente</th>
        <td>{{ trasferta.richiedente.nome }} {{ trasferta.richiedente.cognome }}</td>
    </tr>
    <tr>
        <th>Data Missione</th>
        <td>{{ trasferta.giorno_missione.strftime('%d/%m/%Y') }}</td>
    </tr>
    <tr>
        <th>Destinazione</th>
        <td>{{ trasferta.missione_presso }}</td>
    </tr>
    <tr>
        <th>Motivo missione</th>
        <td>{{ trasferta.motivo_missione }}</td>
    </tr>
    <tr>
        <th>Utilizzo mezzo</th>
        <td>{{ trasferta.utilizzo_mezzo }}</td>
    </tr>
    <tr>
        <th>Aut extra orario</th>
        <td>{{ trasferta.aut_extra_orario }}</td>
    </tr>
    <tr>
        <th>Aut timbratura entrata</th>
        <td>{% if trasferta.aut_timbratura_entrata %}
            {{ trasferta.aut_timbratura_entrata.strftime('%H:%M') }}
            {% else %}
            Non Specificato
            {% endif %}
        </td>
    </tr>
    <tr>
        <th>Aut timbratura uscita</th>
        <td>{% if trasferta.aut_timbratura_uscita %}
            {{ trasferta.aut_timbratura_uscita.strftime('%H:%M') }}
            {% else %}
            Non Specificato
            {% endif %}</td>
    </tr>
    <tr>
        <th>Motivo timbratura</th>
        <td>{{ trasferta.motivo_timbratura }}</td>
    </tr>
    {% if trasferta.note_premissione %}
    <tr>
        <th>Note Richiesta</th>
        {# Usiamo replace('\n', '<br>') e safe per formattare correttamente i salti di riga #}
        <td>{{ trasferta.note_premissione | replace('\n', '<br>') | safe }}</td>
    </tr>
    {% endif %}


    {# BLOCCO INFORMAZIONI DI STATO #}
    <tr>
        <th>Stato Pre-Missione</th>
        <td>{{ trasferta.stato_pre_missione }}</td>
    </tr>
    <tr>
        <th>Stato Post-Missione</th>
        <td>{{ trasferta.stato_post_missione }}</td>
    </tr>


    {# ðŸš¨ BLOCCO INFORMAZIONI DI RENDICONTAZIONE (POST-MISSIONE) #}
    Â  Â  {% if trasferta.stato_post_missione == 'In attesa' or trasferta.stato_post_missione in ['Da rimborsare',
    'Rimborso Concesso', 'Rimborso negato'] %}
    Â  Â  <tr class="table-success mt-3">
        Â  Â  Â  Â  <th colspan="2" class="text-center">Dati di Rendicontazione</th>
        Â  Â  </tr>

    Â  Â  <tr>
        Â  Â  Â  Â  <th>Orari Effettivi</th>
        Â  Â  Â  Â  <td>
            Â  Â  Â  Â  Â  Â  Inizio: {{ trasferta.ora_inizio_effettiva.strftime('%H:%M') if trasferta.ora_inizio_effettiva
            else 'N/A' }} /
            Â  Â  Â  Â  Â  Â  Fine: {{ trasferta.ora_fine_effettiva.strftime('%H:%M') if trasferta.ora_fine_effettiva else
            'N/A' }}
            Â  Â  Â  Â  </td>
        Â  Â  </tr>
    Â  Â  <tr>
        Â  Â  Â  Â  <th>Durata Totale (Ore)</th>
        Â  Â  Â  Â  <td>{{ trasferta.durata_totale_ore or 'N/A' }}</td>
        Â  Â  </tr>
    Â  Â  <tr>
        Â  Â  Â  Â  <th>KM Percorsi</th>
        Â  Â  Â  Â  <td>{{ trasferta.km_percorsi or '0.0' }}</td>
        Â  Â  </tr>
    Â  Â  <tr>
        Â  Â  Â  Â  <th>Mezzo KM Percorsi</th>
        Â  Â  Â  Â  <td>{{ trasferta.mezzo_km_percorsi or 'N/A' }}</td>
        Â  Â  </tr>
    Â  Â  <tr>
        Â  Â  Â  Â  <th>Percorso Effettuato</th>
        Â  Â  Â  Â  <td>{{ trasferta.percorso_effettuato or 'N/A' }}</td>
        Â  Â  </tr>
    Â  Â  <tr>
        Â  Â  Â  Â  <th>Richiesta Pausa Pranzo</th>
        Â  Â  Â  Â  <td>{{ trasferta.richiesta_pausa_pranzo or 'Nessuna' }}</td>
        Â  Â  </tr>
    Â  Â  <tr>
        Â  Â  Â  Â  <th>Extra Orario Richiesto</th>
        Â  Â  Â  Â  <td>{{ trasferta.extra_orario or 'Nessuno' }}</td>
        Â  Â  </tr>
    Â  Â  {% if trasferta.note_rendicontazione %}
    Â  Â  <tr>
        Â  Â  Â  Â  <th>Note Rendiconto</th>
        Â  Â  Â  Â  <td>{{ trasferta.note_rendicontazione | replace('\n', '<br>') | safe }}</td>
        Â  Â  </tr>
    Â  Â  {% endif %}
    Â  Â  {# FINE CAMPI DI RENDICONTAZIONE #}

    Â  Â  {% endif %}

</table>